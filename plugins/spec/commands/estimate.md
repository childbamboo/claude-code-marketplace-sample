---
description: 機能要件から変更範囲・規模・影響を見積もる
argument-hint: [機能要件] [--type] [--breakdown] [--risk]
category: analysis
complexity: standard
mcp-servers: [serena]
---

# /estimate - 変更見積もりコマンド

## 核となる機能

機能要件を分析し、実装に必要な変更範囲・規模・影響を見積もります。複数の実装パターンを提示し、信頼区間とリスクレベルを明示することで、精度の高い意思決定を支援します。

## コマンド構文

```
/estimate [機能要件の説明] [--type scope|effort|complexity] [--breakdown] [--risk]
```

**引数:**
- `機能要件の説明`: 実装したい機能の説明（必須）

**オプション:**
- `--type`: 見積もりの種類を指定
  - `scope`: 変更範囲の見積もり（デフォルト）
  - `effort`: 作業量の見積もり（相対ポイント）
  - `complexity`: 技術的複雑度の評価
- `--breakdown`: 詳細な内訳を出力（コンポーネント別、レイヤー別）
- `--risk`: リスク分析を詳細化（依存関係、技術的負債、外部要因）

## トリガーシナリオ

### 必須トリガー
- 新機能の実装前に工数・影響範囲を把握したい
- 技術的なアプローチを比較検討したい

### 推奨トリガー
- プロジェクト計画時にスコープを明確化したい
- ステークホルダーへの説明資料を作成したい
- リファクタリングの影響範囲を事前調査したい

### プロアクティブトリガー
- 複雑な機能要件を受け取った際の初期分析
- 技術的負債の解消計画策定時

## 実行フロー

### 1. **分析（Analyze）**: 要件とコードベースの調査

$ARGUMENTS の機能要件を以下の観点で整理する：

- 実現したい機能の振る舞い
- 期待されるユーザー体験
- ビジネス上の目的・背景

Serena MCPツールまたはExploreエージェントを使用して調査：

- 既存の類似機能の実装パターン
- 影響を受ける可能性のあるモジュール・コンポーネント
- データ構造・API・UIコンポーネントの依存関係

### 2. **計算（Calculate）**: 見積もりの算出

コードベースのパターンとベンチマークに基づいて見積もりを算出：

- 変更対象ファイル数・行数の概算
- 複雑度の評価（依存関係の深さ、影響範囲の広さ）
- 類似実装との比較による妥当性検証

### 3. **検証（Validate）**: プロジェクトパターンとの照合

- プロジェクトの既存パターンとの整合性確認
- 技術スタックの制約確認
- 過去の類似見積もりとの比較（精度追跡データがある場合）

### 4. **出力（Present）**: 見積もり結果の作成

以下の形式で出力する。

---

## 見積もり結果

### 機能要件サマリ

> [機能要件を1-2文で要約]

---

### パターン A: [パターン名]

#### 変更範囲

| カテゴリ | 対象 | 変更内容 |
|---------|------|---------|
| バックエンド | [ファイル/モジュール名] | [変更概要] |
| フロントエンド | [ファイル/コンポーネント名] | [変更概要] |
| データベース | [テーブル/スキーマ名] | [変更概要] |
| API | [エンドポイント名] | [変更概要] |
| その他 | [対象] | [変更概要] |

#### 変更規模

| 項目 | 見積もり | 信頼区間 |
|------|---------|---------|
| 新規ファイル数 | [数] | [最小-最大] |
| 変更ファイル数 | [数] | [最小-最大] |
| 追加コード行数（概算） | [数] | [最小-最大] |
| 複雑度 | [低/中/高] | - |
| 信頼度 | [高/中/低] | [根拠] |

**信頼度の判定基準:**
- **高（80%以上）**: 類似実装が存在し、影響範囲が明確
- **中（50-80%）**: 部分的に類似実装があるが、不確定要素あり
- **低（50%未満）**: 新規性が高く、不確定要素が多い

#### 影響分析

- **直接影響**: [この変更で直接変わる機能]
- **間接影響**: [依存関係により影響を受ける可能性のある機能]

#### リスク評価

| リスク要因 | レベル | 説明 | 軽減策 |
|-----------|--------|------|--------|
| 技術的複雑度 | [高/中/低] | [具体的な懸念] | [対策] |
| 依存関係 | [高/中/低] | [影響を受けるコンポーネント] | [対策] |
| 外部要因 | [高/中/低] | [外部API、ライブラリ等] | [対策] |
| 技術的負債 | [高/中/低] | [既存コードの問題] | [対策] |

---

### パターン B: [パターン名]（該当する場合）

[パターン A と同じ形式で記載]

---

### 確認事項

機能要件の情報が不足している場合：

- [ ] [確認が必要な項目1]
- [ ] [確認が必要な項目2]
- [ ] [確認が必要な項目3]

---

### 推奨パターン

複数パターンがある場合、推奨するパターンとその理由を記載する。

---

### 5. **記録（Track）**: 精度追跡用データの出力

見積もり精度を継続的に改善するため、以下の形式で記録用データを出力：

```
## 精度追跡データ

- 見積もりID: [YYYYMMDD-機能名の短縮形]
- 見積もり日: [日付]
- 機能概要: [1行サマリ]
- 見積もり値:
  - 変更ファイル数: [数] (信頼区間: [最小-最大])
  - 追加コード行数: [数] (信頼区間: [最小-最大])
  - 複雑度: [低/中/高]
  - 信頼度: [高/中/低]
- 実績値: [実装完了後に記入]
  - 変更ファイル数: [実績]
  - 追加コード行数: [実績]
  - 乖離率: [%]
- 振り返りメモ: [実装完了後に記入]
```

**注意:** このデータはプロジェクトの `docs/estimates/` または適切な場所に保存し、将来の見積もり精度向上に活用する。

---

## 動作境界

**コマンドが実行すること:**
- 機能要件の分析と整理
- コードベースの調査（既存実装・依存関係の把握）
- 複数の実装パターンの提示
- 変更範囲・規模・影響の見積もり（信頼区間付き）
- リスク評価と軽減策の提示
- 精度追跡用データの出力
- 不明点・確認事項の明示

**コマンドが実行しないこと:**
- 実際のコード実装
- 詳細な設計書の作成
- 工数（人日・時間）の見積もり
- 実装タイムラインの作成
- タスクの作成・開始
- 不明点の推測による補完

## 統合要件

**必須ツール:**
- Serena MCP: コードベースのシンボリック分析
- Explore エージェント: コードベースの探索（必要に応じて）

## 使用例

```bash
# 基本的な使用例（スコープ見積もり）
/estimate ユーザーがプロフィール画像をアップロードできる機能

# 詳細な内訳を含める
/estimate ユーザー認証機能の追加 --breakdown

# リスク分析を詳細化
/estimate 決済システムとの連携 --risk

# 複雑度評価
/estimate レガシーAPIのリファクタリング --type complexity

# フルオプション
/estimate マイクロサービス分割 --type effort --breakdown --risk
```

## 成功基準

- ✓ 機能要件が明確に整理されている
- ✓ コードベースの関連箇所が特定されている
- ✓ 変更範囲・規模が具体的なファイル/モジュール名で示されている
- ✓ 信頼区間が明示されている
- ✓ リスク評価と軽減策が提示されている
- ✓ 複数パターンがある場合、それぞれのトレードオフが説明されている
- ✓ 不明点が推測ではなく確認事項として明示されている
- ✓ 見積もりが保守的（楽観的でない）である
- ✓ 精度追跡用データが出力されている
